# Prompt 工程

## 什么是 Prompt 工程？

Prompt 工程是与大模型沟通的艺术和科学。通过精心设计的提示词，引导模型产生更准确、更有用的输出。

## 为什么 Prompt 工程很重要？

```
糟糕的 Prompt → 模糊的输出 → 效果差
优秀的 Prompt → 精准的输出 → 效果好
```

## 基础原则

### 1. 清晰具体

```python
# 糟糕
prompt = "写一篇文章"

# 优秀
prompt = """
请写一篇关于人工智能发展历史的文章，要求：
1. 字数：800-1000字
2. 包含三个主要阶段：早期探索、深度学习革命、大模型时代
3. 语言风格：通俗易懂
4. 目标读者：对AI感兴趣的普通大众
"""
```

### 2. 提供上下文

```python
# 糟糕
prompt = "翻译这段话"

# 优秀
prompt = """
你是一位专业的科技翻译专家。
请将以下英文翻译成中文，要求：
- 保持技术术语准确
- 语言流畅自然
- 适合中国读者阅读习惯

原文：Artificial Intelligence is transforming every industry.
"""
```

### 3. 指定输出格式

```python
prompt = """
分析以下产品的优缺点，以JSON格式输出：

产品：iPhone 15

输出格式：
{
    "product": "产品名称",
    "pros": ["优点1", "优点2"],
    "cons": ["缺点1", "缺点2"],
    "rating": "评分(1-10)"
}
"""
```

## 核心技巧

### 1. 角色设定

```python
prompts = {
    "专家": "你是一位有20年经验的资深软件架构师...",
    "老师": "你是一位耐心的小学数学老师...",
    "翻译": "你是一位精通中英双语的专业翻译...",
    "程序员": "你是一位擅长Python的高级工程师..."
}
```

### 2. Few-shot 学习（少样本学习）

```python
prompt = """
根据示例，判断以下句子的情感：

示例：
句子："这家餐厅太棒了！"
情感：正面

句子："服务态度很差，不会再来了。"
情感：负面

句子："菜品一般，没什么特别的。"
情感：中性

现在请判断：
句子："这部电影让我感动得流泪。"
情感：
"""
```

### 3. Chain of Thought（思维链）

```python
prompt = """
请一步步思考并回答：

问题：小明有5个苹果，给了小红2个，又买了3个，现在有几个？

请按以下格式思考：
1. 小明原来有几个苹果？
2. 给了小红几个？
3. 给完后剩几个？
4. 又买了几个？
5. 现在一共有几个？

答案：
"""
```

### 4. 分步引导

```python
prompt = """
请帮我完成以下任务，分步骤进行：

任务：写一篇产品评测文章

步骤1：列出产品的5个主要特点
步骤2：针对每个特点分析优缺点
步骤3：给出总体评价和购买建议
步骤4：撰写完整的评测文章

请先完成步骤1：
"""
```

## 高级技巧

### 1. 结构化 Prompt

```python
SYSTEM_PROMPT = """
# 角色定义
你是一个专业的代码审查助手。

# 能力范围
- 代码质量分析
- 安全漏洞检测
- 性能优化建议
- 最佳实践推荐

# 输出格式
## 问题列表
- [严重程度] 问题描述

## 改进建议
1. 具体建议

## 优化后代码
```语言
代码
```
"""
```

### 2. 自我反思

```python
prompt = """
请回答以下问题，并进行自我检查：

问题：什么是机器学习？

第一步：给出你的答案
第二步：检查答案是否完整、准确
第三步：如有不足，补充完善

最终答案：
"""
```

### 3. 思维树（Tree of Thoughts）

```python
prompt = """
对于这个问题，请考虑多种可能的解决方案：

问题：如何提高团队的工作效率？

请：
1. 列出至少3种不同的解决思路
2. 分析每种思路的优缺点
3. 选择最佳方案并说明理由
4. 给出具体的实施步骤
"""
```

### 4. ReAct 模式

```python
prompt = """
使用 ReAct 模式回答问题：

Question: 北京今天适合户外运动吗？

Thought: 我需要知道北京今天的天气情况
Action: search("北京今天天气")
Observation: 北京今天晴天，气温25°C，空气质量良好

Thought: 天气条件很好，适合户外运动
Action: finish("北京今天天气很好，适合户外运动")
"""
```

## Prompt 模板库

### 代码生成模板

```python
CODE_GENERATION_PROMPT = """
你是一位专业的{language}开发者。

请根据以下要求生成代码：
- 功能：{functionality}
- 输入：{input_spec}
- 输出：{output_spec}
- 约束条件：{constraints}

要求：
1. 代码清晰、注释完整
2. 包含错误处理
3. 遵循{language}最佳实践
4. 提供使用示例
"""
```

### 文档写作模板

```python
DOCUMENTATION_PROMPT = """
请为以下代码编写文档：

```{language}
{code}
```

文档要求：
1. 功能描述
2. 参数说明（类型、用途、默认值）
3. 返回值说明
4. 使用示例
5. 注意事项
"""
```

### 数据分析模板

```python
DATA_ANALYSIS_PROMPT = """
你是一位数据分析专家。

数据描述：
{data_description}

分析要求：
1. 数据概览
2. 关键指标分析
3. 趋势识别
4. 异常检测
5. 可视化建议
6. 结论和建议

请以专业报告的形式输出。
"""
```

## 常见问题与解决

### 问题1：输出太长或太短

```python
# 解决：明确指定长度
prompt = "用100字左右简要介绍Python语言"
prompt = "详细解释，不少于500字"
```

### 问题2：输出格式不正确

```python
# 解决：提供示例
prompt = """
请按以下格式输出：

名称：xxx
年龄：xxx
职业：xxx

输入：张三，28岁，是一名软件工程师
输出：
名称：张三
年龄：28
职业：软件工程师
"""
```

### 问题3：回答不准确

```python
# 解决：提供更多上下文和约束
prompt = """
背景：这是一个面向初学者的Python教程

问题：什么是变量？

要求：
1. 用简单的语言解释
2. 给出具体例子
3. 避免使用专业术语
"""
```

### 问题4：模型产生幻觉

```python
# 解决：要求模型说明不确定性
prompt = """
请回答以下问题，如果不确定，请明确说明：

问题：Python 3.12 有哪些新特性？

要求：
- 只列出你确定的内容
- 不确定的内容标注"待确认"
- 不要编造信息
"""
```

## Prompt 调优策略

### 迭代优化流程

```
1. 设计初始 Prompt
      ↓
2. 测试并收集结果
      ↓
3. 分析问题
      ↓
4. 修改 Prompt
      ↓
5. 再次测试
      ↓
6. 循环直到满意
```

### A/B 测试

```python
prompt_a = "请解释什么是API"
prompt_b = "请用通俗易懂的语言，向一个非技术人员解释什么是API，并给出生活中的类比"

# 对比两个 prompt 的输出效果
```

## 工具推荐

| 工具 | 用途 |
|------|------|
| PromptPerfect | Prompt 优化 |
| LangSmith | Prompt 调试 |
| OpenAI Playground | 快速测试 |
| Claude Console | Claude Prompt 测试 |

## 下一步

掌握了 Prompt 工程后，学习如何让 Agent 使用工具：
→ [06-工具调用详解](../06-工具调用详解/)
